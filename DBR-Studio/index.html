<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DBR Studio</title>
  <link rel="stylesheet" href="./assets/styles.css"/>
</head>
<body>
  <nav>
    <div class="nav-inner">
      <a class="brand" href="./"><span class="logo"></span> DBR Studio</a>
      <div class="links">
        <a href="./music.html">Music</a>
        <a href="./photography.html">Photography</a>
        <a href="./art.html">Art</a>
        <a href="./CONTRIBUTING.html">Contribute</a>
      </div>
    </div>
  </nav>

  <header class="hero container">
    <h1>Make, share, and vibe.</h1>
    <p>DBR Studio is our creative clubhouse for <strong>music</strong>, <strong>photography</strong>, and <strong>art</strong>. Post playlists, pic-of-the-day, polls, and your own creations—kindly and responsibly.</p>
    <div class="flex" style="margin-top:16px">
      <a class="btn" href="./music.html">Start with Music</a>
      <a class="btn ghost" href="./photography.html">See Photos</a>
      <a class="btn ghost" href="./art.html">Share Art</a>
    </div>
  </header>

  <main class="container">
    <section aria-labelledby="latest-heading">
      <h2 id="latest-heading" class="section-title">Latest from the Club</h2>
      <div id="latest">
        <noscript><p class="muted">Enable JavaScript to view posts.</p></noscript>
      </div>
    </section>

    <section aria-labelledby="sections-heading">
      <h2 id="sections-heading" class="section-title">Sections</h2>
      <div class="grid">
        <div class="card">
          <span class="badge">Music</span>
          <h3>DBR Music</h3>
          <p>Blog, playlists, community polls, and space for DBR musicians to share.</p>
          <a class="btn" href="./music.html">Open</a>
        </div>
        <div class="card">
          <span class="badge">Photography</span>
          <h3>DBR Photography</h3>
          <p>Pic of the Day, favorites, and photo blog.</p>
          <a class="btn" href="./photography.html">Open</a>
        </div>
        <div class="card">
          <span class="badge">Art</span>
          <h3>DBR Art</h3>
          <p>Post your art and browse what others are making.</p>
          <a class="btn" href="./art.html">Open</a>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">© 2025 DBR Studio — Built for GitHub Pages</footer>

  <!-- Inline minimal renderer -->
  <script>
    async function fetchPosts() {
      const url = './posts/posts.json?_=' + Date.now();
      const res = await fetch(url, { cache: 'no-store' });
      if (!res.ok) throw new Error(`Failed to load ${url}: ${res.status}`);
      return res.json();
    }

    function renderPost(p) {
      const tags = Array.isArray(p.tags) ? p.tags.join(', ') : '';
      const hasMany = Array.isArray(p.images) && p.images.length > 0;
      const img = p.image || (hasMany ? p.images[0] : null);

      let media = '';
      if (p.embed) {
        media = `<div class="embed">${p.embed}</div>`;
      } else if (img) {
        media = `<div class="media"><img src="${img}" alt="${p.title || ''}"></div>`;
      } else if (p.link) {
        media = `<p class="ext"><a href="${p.link}" target="_blank" rel="noopener">Open link →</a></p>`;
      }

      const thumbs = hasMany ? `<div class="thumbs">${p.images.map(u => `<img src="${u}" alt="" loading="lazy">`).join('')}</div>` : '';

      return `
        <article class="card">
          ${media}
          <div class="content">
            <h3>${p.title || 'Untitled'}</h3>
            <p class="meta">${p.date || ''}${tags ? ' · ' + tags : ''}</p>
            ${p.summary ? `<p>${p.summary}</p>` : ''}
            ${p.caption ? `<p class="caption">${p.caption}</p>` : ''}
            ${thumbs}
          </div>
        </article>
      `;
    }

    async function boot() {
      const mount = document.getElementById('latest');
      try {
        const posts = await fetchPosts();
        if (!Array.isArray(posts) || posts.length === 0) {
          mount.innerHTML = `<p class="muted">No posts yet.</p>`;
          console.warn('posts.json loaded but is empty or not an array.', posts);
          return;
        }
        // Show the latest 12
        const list = posts.slice(0, 12).map(renderPost).join('');
        mount.innerHTML = list;
      } catch (err) {
        console.error(err);
        mount.innerHTML = `<div class="error">Could not load posts.</div>`;
      }
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
